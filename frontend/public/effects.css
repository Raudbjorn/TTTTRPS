/* =============================================================================
   TTRPG Assistant - Visual Effects System
   Version 1.0.0

   Consolidated visual effects for theming. These classes can be applied to
   any element or container to add atmospheric effects appropriate to the
   current theme.

   WCAG 2.1 AA Compliant: All effects respect prefers-reduced-motion.
============================================================================= */

/* -----------------------------------------------------------------------------
   Film Grain Effect

   Adds a subtle animated noise overlay to create a film/photo grain effect.
   Particularly effective for Cosmic (eldritch horror) and Noir themes.

   Usage: Add class to a container element (typically body or main wrapper)
   Intensity controlled by: --effect-grain (0-1)
----------------------------------------------------------------------------- */
.effect-film-grain {
  position: relative;
}

.effect-film-grain::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  opacity: var(--effect-grain, 0.05);
  pointer-events: none;
  mix-blend-mode: overlay;
  z-index: 9999;
  animation: grain 0.5s steps(10) infinite;
}

@keyframes grain {
  0%, 100% { transform: translate(0, 0); }
  10% { transform: translate(-5%, -10%); }
  20% { transform: translate(-15%, 5%); }
  30% { transform: translate(7%, -25%); }
  40% { transform: translate(-5%, 25%); }
  50% { transform: translate(-15%, 10%); }
  60% { transform: translate(15%, 0%); }
  70% { transform: translate(0%, 15%); }
  80% { transform: translate(3%, 35%); }
  90% { transform: translate(-10%, 10%); }
}

/* -----------------------------------------------------------------------------
   CRT Scanlines Effect

   Adds horizontal scanline overlay simulating CRT monitor display.
   Ideal for Terminal and Neon (cyberpunk) themes.

   Usage: Add class to a container element
   Intensity controlled by: --effect-scanline (0-1)
----------------------------------------------------------------------------- */
.effect-scanlines {
  position: relative;
}

.effect-scanlines::after {
  content: '';
  position: fixed;
  inset: 0;
  background: repeating-linear-gradient(
    0deg,
    rgba(0, 0, 0, 0.15),
    rgba(0, 0, 0, 0.15) 1px,
    transparent 1px,
    transparent 2px
  );
  opacity: var(--effect-scanline, 0.3);
  pointer-events: none;
  z-index: 9998;
}

/* Alternative: Thicker scanlines for more pronounced effect */
.effect-scanlines-thick::after {
  content: '';
  position: fixed;
  inset: 0;
  background: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    oklch(0% 0 0 / 0.15) 2px,
    oklch(0% 0 0 / 0.15) 4px
  );
  opacity: var(--effect-scanline, 0.3);
  pointer-events: none;
  z-index: 9998;
}

/* -----------------------------------------------------------------------------
   Text Glow Effect

   Adds a colored glow around text, using the accent color.
   Perfect for Terminal (green phosphor) and Neon themes.

   Usage: Add class to text elements
   Intensity controlled by: --effect-glow (0-1), uses --accent for color
----------------------------------------------------------------------------- */
.effect-text-glow {
  text-shadow:
    0 0 10px var(--accent, oklch(75% 0.15 145)),
    0 0 20px var(--accent, oklch(75% 0.15 145));
}

/* Intense glow variant for headers/emphasis */
.effect-text-glow-intense {
  text-shadow:
    0 0 5px var(--accent, oklch(75% 0.15 145)),
    0 0 15px var(--accent, oklch(75% 0.15 145)),
    0 0 30px var(--accent, oklch(75% 0.15 145)),
    0 0 50px var(--glow-color, oklch(75% 0.15 145 / 0.5));
}

/* Subtle glow for body text */
.effect-text-glow-subtle {
  text-shadow:
    0 0 2px var(--glow-color, oklch(75% 0.15 145 / 0.3)),
    0 0 8px var(--glow-color, oklch(75% 0.15 145 / 0.3));
}

/* Pulsing glow animation */
.effect-text-glow-pulse {
  animation: neon-pulse 2s ease-in-out infinite;
}

@keyframes neon-pulse {
  0%, 100% {
    text-shadow:
      0 0 5px var(--glow-color, oklch(75% 0.15 145 / 0.3)),
      0 0 10px var(--glow-color, oklch(75% 0.15 145 / 0.3)),
      0 0 20px var(--glow-color, oklch(75% 0.15 145 / 0.3));
  }
  50% {
    text-shadow:
      0 0 10px var(--glow-color, oklch(75% 0.15 145 / 0.3)),
      0 0 20px var(--glow-color, oklch(75% 0.15 145 / 0.3)),
      0 0 40px var(--glow-color, oklch(75% 0.15 145 / 0.3));
  }
}

/* -----------------------------------------------------------------------------
   Redacted Text Effect (Noir Theme)

   Blacks out text to appear redacted/censored. Reveals on hover/focus.
   Perfect for Delta Green, spy games, and noir themes.

   Usage: Wrap sensitive text in span with this class
----------------------------------------------------------------------------- */
.effect-redacted {
  background: currentColor;
  color: transparent;
  user-select: none;
  cursor: pointer;
  transition: all var(--transition-base, 200ms ease-out);
  border-radius: 2px;
  padding: 0 0.15em;
}

.effect-redacted:hover,
.effect-redacted:focus {
  background: transparent;
  color: inherit;
  outline: 2px solid var(--accent, oklch(45% 0.08 25));
  outline-offset: 2px;
}

/* Click-to-reveal variant (requires JS to add .revealed class) */
.effect-redacted-permanent {
  background: currentColor;
  color: transparent;
  user-select: none;
  cursor: pointer;
  transition: all var(--transition-base, 200ms ease-out);
  border-radius: 2px;
  padding: 0 0.15em;
}

.effect-redacted-permanent.revealed {
  background: transparent;
  color: inherit;
}

/* Strikethrough redaction style */
.effect-redacted-striped {
  background: repeating-linear-gradient(
    -45deg,
    currentColor,
    currentColor 2px,
    transparent 2px,
    transparent 4px
  );
  color: transparent;
  user-select: none;
  padding: 0 0.15em;
}

/* -----------------------------------------------------------------------------
   Vignette Effect

   Adds dark edges around the viewport for a cinematic look.
   Works well with Cosmic and Noir themes.

   Usage: Add to body or main container
----------------------------------------------------------------------------- */
.effect-vignette::before {
  content: '';
  position: fixed;
  inset: 0;
  background: radial-gradient(
    ellipse at center,
    transparent 50%,
    oklch(0% 0 0 / 0.4) 100%
  );
  pointer-events: none;
  z-index: 9997;
}

/* Stronger vignette for horror themes */
.effect-vignette-strong::before {
  content: '';
  position: fixed;
  inset: 0;
  background: radial-gradient(
    ellipse at center,
    transparent 30%,
    oklch(0% 0 0 / 0.6) 100%
  );
  pointer-events: none;
  z-index: 9997;
}

/* -----------------------------------------------------------------------------
   Glitch Effect

   Creates a chromatic aberration/glitch effect on text.
   Requires data-text attribute with same content as element.
   Ideal for Neon/cyberpunk themes.

   Usage: <span class="effect-glitch" data-text="GLITCH">GLITCH</span>
----------------------------------------------------------------------------- */
.effect-glitch {
  position: relative;
  display: inline-block;
}

.effect-glitch::before,
.effect-glitch::after {
  content: attr(data-text);
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.effect-glitch::before {
  color: oklch(70% 0.25 200 / 0.5);
  clip-path: inset(0 0 50% 0);
  transform: translateX(-2px);
  animation: glitch-shift 3s infinite linear alternate-reverse;
}

.effect-glitch::after {
  color: oklch(70% 0.25 350 / 0.5);
  clip-path: inset(50% 0 0 0);
  transform: translateX(2px);
  animation: glitch-shift 2s infinite linear alternate;
}

@keyframes glitch-shift {
  0%, 80%, 100% { transform: translateX(0); }
  85% { transform: translateX(-2px); }
  90% { transform: translateX(2px); }
  95% { transform: translateX(-1px); }
}

/* -----------------------------------------------------------------------------
   Terminal Flicker Effect

   Subtle screen flicker simulating old CRT monitors.
   Use sparingly on Terminal theme.

   Usage: Add to container
----------------------------------------------------------------------------- */
.effect-flicker {
  animation: terminal-flicker 4s ease-in-out infinite;
}

@keyframes terminal-flicker {
  0%, 100% { opacity: 1; }
  3% { opacity: 0.85; }
  6% { opacity: 1; }
  7% { opacity: 0.9; }
  8% { opacity: 1; }
  9% { opacity: 0.88; }
  10% { opacity: 1; }
}

/* -----------------------------------------------------------------------------
   Typewriter Effect (Noir Theme)

   Reveals text character by character like a typewriter.
   Note: Works best with monospace fonts and known-width text.

   Usage: Add to text element, set width appropriately
----------------------------------------------------------------------------- */
.effect-typewriter {
  animation: typewriter-reveal 2s steps(40) forwards;
  white-space: nowrap;
  overflow: hidden;
  border-right: 2px solid var(--accent, currentColor);
}

@keyframes typewriter-reveal {
  from {
    clip-path: inset(0 100% 0 0);
  }
  to {
    clip-path: inset(0 0 0 0);
  }
}

/* Blinking cursor after typewriter completes */
.effect-typewriter::after {
  content: '';
  animation: cursor-blink 0.7s step-end infinite;
}

@keyframes cursor-blink {
  0%, 100% { border-color: transparent; }
  50% { border-color: var(--accent, currentColor); }
}

/* -----------------------------------------------------------------------------
   Glassmorphism Effect

   Frosted glass effect with blur and transparency.
   Primary effect for Fantasy theme panels.

   Usage: Add to card/panel elements
----------------------------------------------------------------------------- */
.effect-glass {
  background: var(--bg-surface, oklch(20% 0.03 280 / 0.8));
  backdrop-filter: blur(var(--effect-blur, 12px));
  -webkit-backdrop-filter: blur(var(--effect-blur, 12px));
  border: 1px solid var(--border-subtle, oklch(30% 0.03 280 / 0.5));
}

/* Stronger glass effect */
.effect-glass-strong {
  background: var(--bg-elevated, oklch(25% 0.04 280 / 0.9));
  backdrop-filter: blur(calc(var(--effect-blur, 12px) * 1.5));
  -webkit-backdrop-filter: blur(calc(var(--effect-blur, 12px) * 1.5));
  border: 1px solid var(--border-strong, oklch(75% 0.12 45 / 0.6));
}

/* -----------------------------------------------------------------------------
   Box Glow Effect

   Adds glowing border/shadow to elements.
   Works well with Terminal and Neon themes.

   Usage: Add to card/button elements
----------------------------------------------------------------------------- */
.effect-box-glow {
  box-shadow:
    0 0 4px var(--glow-color, oklch(75% 0.15 145 / 0.3)),
    0 0 12px var(--glow-color, oklch(75% 0.15 145 / 0.3));
}

.effect-box-glow-intense {
  box-shadow:
    0 0 8px var(--glow-color, oklch(75% 0.15 145 / 0.3)),
    0 0 20px var(--glow-color, oklch(75% 0.15 145 / 0.3)),
    0 0 40px var(--glow-color, oklch(75% 0.15 145 / 0.3));
}

/* Pulsing box glow */
.effect-box-glow-pulse {
  animation: box-glow-pulse 2s ease-in-out infinite;
}

@keyframes box-glow-pulse {
  0%, 100% {
    box-shadow:
      0 0 4px var(--glow-color, oklch(75% 0.15 145 / 0.3)),
      0 0 12px var(--glow-color, oklch(75% 0.15 145 / 0.3));
  }
  50% {
    box-shadow:
      0 0 8px var(--glow-color, oklch(75% 0.15 145 / 0.3)),
      0 0 24px var(--glow-color, oklch(75% 0.15 145 / 0.3)),
      0 0 48px var(--glow-color, oklch(75% 0.15 145 / 0.3));
  }
}

/* -----------------------------------------------------------------------------
   Classified Stamp Effect (Noir Theme)

   Creates a "CLASSIFIED" or "TOP SECRET" stamp effect.
   Perfect for Delta Green document styling.

   Usage: <span class="effect-stamp">CLASSIFIED</span>
----------------------------------------------------------------------------- */
.effect-stamp {
  position: relative;
  display: inline-block;
  text-transform: uppercase;
  font-weight: bold;
  letter-spacing: 0.1em;
  color: var(--danger, oklch(55% 0.15 25));
  border: 3px solid var(--danger, oklch(55% 0.15 25));
  padding: 0.25em 0.5em;
  transform: rotate(-5deg);
  opacity: 0.85;
}

.effect-stamp::before {
  content: '';
  position: absolute;
  inset: -4px;
  border: 2px solid var(--danger, oklch(55% 0.15 25));
  opacity: 0.3;
}

/* Faded stamp variant */
.effect-stamp-faded {
  position: relative;
  display: inline-block;
  text-transform: uppercase;
  font-weight: bold;
  letter-spacing: 0.1em;
  color: var(--danger, oklch(55% 0.15 25));
  border: 2px solid var(--danger, oklch(55% 0.15 25));
  padding: 0.2em 0.4em;
  transform: rotate(-3deg);
  opacity: 0.5;
}

/* -----------------------------------------------------------------------------
   Accessibility: Reduced Motion Support

   WCAG 2.1 AAA compliant - disables all animations and effects that could
   cause motion sickness or distraction for users who prefer reduced motion.
----------------------------------------------------------------------------- */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }

  /* Remove overlay effects entirely */
  .effect-film-grain::before,
  .effect-scanlines::after,
  .effect-scanlines-thick::after,
  .effect-vignette::before,
  .effect-vignette-strong::before {
    display: none !important;
  }

  /* Disable animated effects */
  .effect-text-glow-pulse,
  .effect-flicker,
  .effect-typewriter,
  .effect-box-glow-pulse {
    animation: none !important;
  }

  /* Remove glitch pseudo-elements */
  .effect-glitch::before,
  .effect-glitch::after {
    display: none !important;
  }

  /* Keep static glow effects but remove animation */
  .effect-text-glow,
  .effect-text-glow-intense,
  .effect-text-glow-subtle {
    animation: none !important;
  }

  /* Keep redacted effect functional but remove transition */
  .effect-redacted,
  .effect-redacted-permanent {
    transition: none !important;
  }
}

/* -----------------------------------------------------------------------------
   High Contrast Mode Support

   Simplifies effects for users who need higher contrast.
----------------------------------------------------------------------------- */
@media (prefers-contrast: more) {
  /* Remove blur effects */
  .effect-glass,
  .effect-glass-strong {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    background: var(--bg-surface) !important;
    border-width: 2px !important;
  }

  /* Remove glow effects */
  .effect-text-glow,
  .effect-text-glow-intense,
  .effect-text-glow-subtle,
  .effect-text-glow-pulse {
    text-shadow: none !important;
  }

  .effect-box-glow,
  .effect-box-glow-intense,
  .effect-box-glow-pulse {
    box-shadow: none !important;
  }

  /* Remove overlay effects */
  .effect-film-grain::before,
  .effect-scanlines::after,
  .effect-vignette::before {
    display: none !important;
  }
}

/* -----------------------------------------------------------------------------
   Print Styles

   Removes all visual effects for print output.
----------------------------------------------------------------------------- */
@media print {
  .effect-film-grain::before,
  .effect-scanlines::after,
  .effect-scanlines-thick::after,
  .effect-vignette::before,
  .effect-vignette-strong::before,
  .effect-glitch::before,
  .effect-glitch::after {
    display: none !important;
  }

  .effect-text-glow,
  .effect-text-glow-intense,
  .effect-text-glow-subtle,
  .effect-text-glow-pulse {
    text-shadow: none !important;
  }

  .effect-box-glow,
  .effect-box-glow-intense,
  .effect-box-glow-pulse {
    box-shadow: none !important;
  }

  .effect-redacted {
    background: transparent !important;
    color: inherit !important;
  }

  .effect-stamp,
  .effect-stamp-faded {
    border-color: #000 !important;
    color: #000 !important;
  }
}
